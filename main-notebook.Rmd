---
title: "Reccomendation systems in R"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

Carichiamo il dataset del sistema di raccomandazione all'interno del progetto:
```{r}
movie_dataset <- read.csv('movie-dataset/movies.csv',  sep = ',')
rating_dataset <- read.csv('movie-dataset/ratings.csv', sep = ',')
```

Una volta caricati i dati, verifichiamone l'**integrità**.  
La presenza di dati incompleti influisce negativamente sui risultati dell'analisi, rischiando l'alterazione del risultato finale.  
Effettuiamo quindi una pulizia sui dati:  
```{r}
movie_dataset <- movie_dataset[complete.cases(movie_dataset), ]
rating_dataset <- rating_dataset[complete.cases(rating_dataset), ]
```

Dopo aver ottenuto un dataset pulito, possiamo procedere alla creazione della matrice di utilità.  
Essendo il nostro dataset organizzato per righe, è necessario effettuare una conversione.  
Utilizziamo il pacchetto [reshape2](https://cran.r-project.org/web/packages/reshape2/index.html), in particolare la funzione `dcast`.  
Questa funzione, ricevendo in input la matrice, la formula per creare righe / colonne e il valore da inserire nelle celle, ci restituisce una matrice.  
Utilizziamola nel nostro caso:
```{r}
library("reshape2")
converted_matrix <- acast(rating_dataset, userId~movieId, value.var = "rating")
```

Instanziamo quindi il nostro sistema di raccomandazione, usando `reccomendlab` e normalizziamo:
```{r}
library("recommenderlab")
rating_matrix <- as(converted_matrix, "realRatingMatrix")
normalized_matrix <- normalize(rating_matrix)
```

Addestramento del sistema, split dei dati:
```{r}
library("recommenderlab")
splitted_matrix <- evaluationScheme(normalized_matrix, method="split", train=0.9, given=15)
```

Aggiungere validazione:
```{r}
library("recommenderlab")
ubcf_model <- Recommender(getData(splitted_matrix, "train"), "UBCF")
ubcf_test <- predict(ubcf_model, getData(splitted_matrix, "known"), type="ratings")
ubcf_error <- calcPredictionAccuracy(ubcf_test, getData(splitted_matrix, "unknown"))

print(ubcf_error)
```

Vedi altre risorse:  
- [Reccomendation 101](https://www.r-bloggers.com/2014/12/recommender-systems-101-a-step-by-step-practical-example-in-r/)  
- [Data Mania](https://www.data-mania.com/blog/how-to-build-a-recommendation-engine-in-r/)  
- [Res 1](https://rpubs.com/robertwsellers/IS643_Project_2)   
- [Res 2](https://rpubs.com/dhairavc/628480)  
- [Res 3](https://www.linkedin.com/pulse/create-recommendation-engine-using-r-simple-steps-minta-thomas/)  

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
